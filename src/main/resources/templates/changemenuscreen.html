{{>header}}
<div class="container">
    <h1>Dishes</h1>

    <table id="dishTable" class="display">
        <thead>
        <tr>
            <th data-data="name">Name</th>
            <th data-data="price">Price in â‚¬</th>
            <th data-data="description">Description</th>
        </tr>
        </thead>
    </table>


    <div id="entryModal" class="modal fade" role="dialog">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">

                    <button type="button" class="close" onclick="deselect()" data-dismiss="modal">&times;</button>
                    <h3 id="modal-title" class="modal-title">Ingredient</h3>

                </div>
                <div class="modal-body">

                    <p>Coole dingen</p>

                </div>
                <div class="modal-footer">

                    <button id="btnsubmit" class="btn btn-primary">Submit</button>
                    <button id="btndelete" class="btn btn-danger">Delete</button>
                    <button id="btnclose" class="btn btn-default" data-dismiss="modal">Close</button>

                </div>
            </div>
        </div>
    </div>

</div>

<script>
    var _restEndpoint = '/api/dishes/';
    var _tableElement = $('#dishTable');
    var _modalElement = $('#entryModal');

    var _dataTable = _tableElement.DataTable({
    ajax: {
    url: _restEndpoint,
    dataSrc: "",
    type: "GET",
    },
    });

    _tableElement.on('click', 'tr', function () {
    _tableElement.find('tr.selected').removeClass('selected');
    $(this).toggleClass('selected');

    var data = _dataTable.row(this).data();

    if(!data) {
    console.error('unable to retrieve data');
    return;
    }

    $.get(_restEndpoint + data.id, function(data) {
    if(!data) return;

    openModalForObject(data);
    });

    });

    function openModalForObject(data) {
    var _commentField = _modalElement.find('#comment');
    var _readyField   = _modalElement.find('#ready');

    _commentField.val(data.comment);
    _readyField.prop('checked', data.ready);

    _modalElement.find('#modal-title').html('Edit Ingredient');

    _modalElement.find('#btnsubmit')
    .off('click')
    .on('click', function() {
    var saveData = {
    id: data.id,
    comment: _commentField.val(),
    ready: _readyField.is(':checked'),
    };

    $.ajax({
    contentType : 'application/json',
    url: _restEndpoint,
    type: 'post',
    data: JSON.stringify(saveData),
    success: function() {
    _modalElement.modal('hide');
    reloadData();
    },
    });
    });

    _modalElement.find('#btndelete')
    .off('click')
    .on('click', function() {
    var result = confirm('this action can not be undone');

    if(result) {
    $.ajax({
    contentType : 'application/json',
    url: _restEndpoint + data.id,
    type: 'delete',
    success: function() {
    _modalElement.modal('hide');
    reloadData();
    },
    });
    }
    });

    _modalElement.modal('show');
    }

    function reloadData() {
    _dataTable.ajax.reload();
    }
</script>
{{>footer}}